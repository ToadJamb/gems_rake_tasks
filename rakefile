require 'cane'
require 'gems'
require 'travis/yaml' if RUBY_VERSION.match(/\d+/).to_s.to_i > 1
require 'wwtd/tasks'

require_relative 'lib/rake_tasks'
[
  'cane',
  'doc',
  'gem',
  'rdoc',
  'spec',
  'test',
  'checksum',
  'console',
  'travis_ci_lint',
].each do |task|
  require_relative File.join('lib/rake_tasks/tasks', task)
end

$VERBOSE = true

task :default
Rake::Task[:default].clear_prerequisites

def figure_it_out(reqs, specs, ci, base = :basic, default = :default)
  if ci
    task base => (reqs + specs).flatten
  else
    task base => specs
  end

  task default => [
    reqs,
    'wwtd:parallel',
  ].flatten
end

reqs = []
reqs << :cane
reqs << 'travis_ci:lint' if Kernel.const_defined?('Travis')

specs = [
  :spec,
  'test:unit',
]

figure_it_out reqs, specs, ENV['CI'] && !ENV['CI'].empty?
