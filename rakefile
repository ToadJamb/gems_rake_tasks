# frozen_string_literal: true

require 'cane'
require 'gems'
require 'travis/yaml' if RUBY_VERSION.match(/\d+/).to_s.to_i > 1
require 'wwtd/tasks'

require_relative 'lib/rake_tasks'
[
  'cane',
  'doc',
  'gem',
  'rdoc',
  'spec',
  'test',
  'checksum',
  'console',
  'travis_ci_lint',
  'release',
].each do |task|
  require_relative File.join('lib/rake_tasks/tasks', task)
end

$VERBOSE = true

def build_defaults(reqs, specs, ci, base = :basic, default = :default)
  task base
  Rake::Task[base].clear_prerequisites

  if ci
    task base => (reqs + specs).flatten
  else
    task base => specs
  end

  task default
  Rake::Task[default].clear_prerequisites

  task default => [
    reqs,
    'wwtd:parallel',
  ].flatten
end

reqs = []
reqs << :cane
reqs << 'travis_ci:lint' if Kernel.const_defined?('Travis')

specs = [
  :spec,
  'test:unit',
]

build_defaults reqs, specs, !ENV['CI'].to_s.strip.empty?
